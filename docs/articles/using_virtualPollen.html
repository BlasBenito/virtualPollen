<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>virtualPollen • virtualPollen</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="virtualPollen">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">virtualPollen</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/using_virtualPollen.html">virtualPollen</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/BlasBenito/virtualPollen">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><script src="using_virtualPollen_files/kePrint-0.0.1/kePrint.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>virtualPollen</h1>
            <h3 class="subtitle">Generation of virtual pollen curves</h3>
                        <h4 class="author">Blas M. Benito</h4>
            
            <h4 class="date">2019-06-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/BlasBenito/virtualPollen/blob/master/vignettes/using_virtualPollen.Rmd"><code>vignettes/using_virtualPollen.Rmd</code></a></small>
      <div class="hidden name"><code>using_virtualPollen.Rmd</code></div>

    </div>

    
    
<p><strong>Summary</strong></p>
<p>This document describes in detail the methods used to generate a virtual environmental driver with a given temporal autocorrelation, to be used as an input for a population model simulating synthetic pollen curves generated by virtual taxa with different life-traits (life-span and fecundity) and environmental niche features (niche position and breadth). We also describe how we generated a virtual sediment accumulation rate to aggregate the results of the population model to mimic taphonomic processes producing real pollen curves, and how we resampled virtual pollen data at different depth intervals. Finally, we present the code used to generate the 16 virtual taxa used for the analyses described in the paper.</p>
<p><strong>IMPORTANT:</strong> An Rmarkdown version of this document can be found at: <a href="https://github.com/BlasBenito/EcologicalMemory" class="uri">https://github.com/BlasBenito/EcologicalMemory</a>.</p>

<p>#Generating a virtual environmental driver#</p>
<p>###Rationale###</p>
<p>To simulate virtual pollen curves with the population model described in section <strong>2</strong> a virtual driver representing changes in environmental conditions is required. This section explains how to generate such a driver as a time series with a given temporal autocorrelation simulating the temporal structure generally shown by observed environmental drivers.</p>
<p>###Generating a random walk###</p>
<p>The following steps are required to generate a <strong>random walk</strong> in R:</p>
<ol style="list-style-type: decimal">
<li><p>Generate a vector <em>time</em> with time values.</p></li>
<li><p>Re-sample with replacement the set of numbers (-1, 0, 1) as many times as values are in the <em>time</em> vector, to produce the vector <em>moves</em> (as in <em>moves of a random walk</em>).</p></li>
<li><p>Compute the cumulative sum of <em>moves</em>, which generates the random walk.</p></li>
</ol>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co">#sets a state for the generator of pseudo-random numbers</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">#defines the variable "time"</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">time &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10000</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#samples (-1, 0, 1) with replacement </span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">moves &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sample">sample</a></span>(<span class="dt">x=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">size=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(time), <span class="dt">replace=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#computes the cumulative sum of moves</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8">random.walk &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cumsum">cumsum</a></span>(moves)</a></code></pre></div>
<div class="figure">
<img src="using_virtualPollen_files/figure-html/unnamed-chunk-2-1.png" alt="Random walk (a) and its temporal autocorrelation (b)." width="864"><p class="caption">
Random walk (a) and its temporal autocorrelation (b).
</p>
</div>
<p>Every time this code is executed with a different number in <em>set.seed()</em>, it generates a different random walk with a different temporal autocorrelation, but still, this simple method is not useful to generate a time series with a given temporal autocorrelation.</p>
<p>###Applying a convolution filter to generate a given temporal autocorrelation###</p>
<p>Applying a <strong>convolution</strong> filter to a time series allows to generate dependence among sets of consecutive cases. Below we show an example of how it works on a random sequence <em>a</em> composed by five numbers in the range [0, 1]. The operations to compute the filtered sequence are shown in <strong>Table 1</strong>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co">#setting a fixed seed for the generator of pseudo-random numbers</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#generating 5 random numbers in the range [0, 1]</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">a &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#applying a convolution filter of length 2 and value 1</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">b &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(a, <span class="dt">filter=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="dt">method=</span><span class="st">"convolution"</span>, <span class="dt">circular=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<div class="figure">
<img src="using_virtualPollen_files/figure-html/unnamed-chunk-4-1.png" alt="Original sequence (dashed line) and filtered sequence with filter (solid line)." width="864"><p class="caption">
Original sequence (dashed line) and filtered sequence with filter (solid line).
</p>
</div>
<table class="table table">
<caption>
Original sequence (a), filtered sequence (b), and filtering operations. Numbers beside letters a and b represent row numbers, while f1 and f2 represent the values of the convolution filter (both equal to 1 in this case).
</caption>
<thead><tr>
<th style="text-align:right;">
row
</th>
<th style="text-align:right;">
a
</th>
<th style="text-align:right;">
b
</th>
<th style="text-align:left;">
operation
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.27
</td>
<td style="text-align:right;">
0.64
</td>
<td style="text-align:left;">
b1 = a1 x f2 + a2 x f1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.37
</td>
<td style="text-align:right;">
0.94
</td>
<td style="text-align:left;">
b2 = a2 x f2 + a3 x f1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.57
</td>
<td style="text-align:right;">
1.48
</td>
<td style="text-align:left;">
b3 = a3 x f2 + a4 x f1
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.91
</td>
<td style="text-align:right;">
1.11
</td>
<td style="text-align:left;">
b4 = a4 x f2 + a5 x f1
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.20
</td>
<td style="text-align:right;">
0.47
</td>
<td style="text-align:left;">
b5 = a5 x f2 + a6 x f1
</td>
</tr>
</tbody>
</table>
<p>The <em>operation</em> column in <strong>Table 1</strong> shows how the convolution filter generates a dependence between values located within the length of the filter. This positional dependence creates a temporal autocorrelation pattern with a significant length equal to the length of the filter. The following piece of code demonstrates this by generating two versions of the same <em>moves</em> vector used before, one with a length of the significant temporal autocorrelation equal to 10 (defined in the same units of the <em>time</em> vector), and another with a length of 100. Results are shown in <strong>Figure 3</strong>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">moves<span class="fl">.10</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(moves, <span class="dt">filter=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="dt">circular=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">moves<span class="fl">.100</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(moves, <span class="dt">filter=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>, <span class="dv">100</span>), <span class="dt">circular=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<div class="figure">
<img src="using_virtualPollen_files/figure-html/unnamed-chunk-7-1.png" alt="Sequences filtered with different filter lengths: a) Sequence with autocorrelation length equal to 10; b) Temporal autocorrelation of a); c) Sequence with autocorrelation length equal to 100: d) Temporal autocorrelation of c)." width="864"><p class="caption">
Sequences filtered with different filter lengths: a) Sequence with autocorrelation length equal to 10; b) Temporal autocorrelation of a); c) Sequence with autocorrelation length equal to 100: d) Temporal autocorrelation of c).
</p>
</div>
<p>A major limitation is that this method does not work well when the required length of the temporal autocorrelation is a large fraction of the overall length of the time series. The code below and <strong>Figure 4</strong> show an example with a filter of length 5000 (note that the <em>time</em> variable has 10000 elements).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">moves<span class="fl">.5000</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(moves, <span class="dt">filter=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>, <span class="dv">5000</span>), <span class="dt">circular=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<div class="figure">
<img src="using_virtualPollen_files/figure-html/unnamed-chunk-9-1.png" alt="Sequence moves.5000 (a) and its temporal autocorrelation (b). In this case there is a large deviation between the required temporal autocorrelation (5000) and the outcome (2000)." width="864"><p class="caption">
Sequence moves.5000 (a) and its temporal autocorrelation (b). In this case there is a large deviation between the required temporal autocorrelation (5000) and the outcome (2000).
</p>
</div>
<p>All the ideas presented above are implemented in the functions named <strong>simulateDriver()</strong> and <strong>simulateDriverS</strong>, with these main arguments:</p>
<ul>
<li>
<strong>random.seed</strong>: an integer for <em>set.seed()</em>, to use the same random seed in the generation of random numbers and make sure that results are reproducible.</li>
<li>
<strong>age</strong>: a vector (i.e. 1:1000), representing the length of the output.</li>
<li>
<strong>autocorrelation.length</strong>: length of the desired temporal autocorrelation structure, in the same units as <em>age</em>.</li>
<li>
<strong>output.min</strong>: minimum value of the driver.</li>
<li>
<strong>output.max</strong>: maximum value of the driver.</li>
</ul>
<p><strong>Figure 5</strong> shows a driver generated with <strong>simulateDriverS</strong> with annual resolution in the range [0, 100], over a period of 10000 years, with a temporal autocorrelation length of 600 years.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">driver &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simulateDriverS.html">simulateDriverS</a></span>(</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"> <span class="dt">random.seeds=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">60</span>, <span class="dv">120</span>),</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"> <span class="dt">time=</span><span class="dv">1</span><span class="op">:</span><span class="dv">10000</span>,</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"> <span class="dt">autocorrelation.lengths =</span> <span class="dv">600</span>,</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"> <span class="dt">output.min=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb5-6" data-line-number="6"> <span class="dt">output.max=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">100</span>, <span class="dv">100</span>),</a>
<a class="sourceLine" id="cb5-7" data-line-number="7"> <span class="dt">driver.names=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"A"</span>, <span class="st">"B"</span>),</a>
<a class="sourceLine" id="cb5-8" data-line-number="8"> <span class="dt">filename=</span><span class="ot">NULL</span>)</a></code></pre></div>
<div class="figure">
<img src="using_virtualPollen_files/figure-html/unnamed-chunk-10-1.png" alt="Virtual driver and its temporal autocorrelation. Note that virtual driver B will not be used hereafter to simplify the explanation on the model dynamics." width="864"><p class="caption">
Virtual driver and its temporal autocorrelation. Note that virtual driver B will not be used hereafter to simplify the explanation on the model dynamics.
</p>
</div>
<p>#Simulating pollen curves from virtual taxa#</p>
<p>###Rationale###</p>
<p>The ability of plant populations to respond more or less quickly to environmental change is mediated by a set of species’ traits, such as niche optimum and breadth, growth rate, sexual maturity age, effective fecundity, and life span. Even though we have values for these traits for many plant species, pollen types are often clusters of species of the same genus or family rather than single species, making the assignment of trait values uncertain. For the purpose of this paper it is more practical to work with <strong>virtual pollen curves</strong> generated by <strong>virtual taxa</strong> with known relationships with the environment and traits. These virtual taxa are the result of a population model with different parametrizations.</p>
<p>###Assumptions###</p>
<p>The model follows these assumptions:</p>
<ul>
<li>
<strong>The spatial structure of the population is not important to explain its pollen productivity</strong>. This is an operative assumption, to speed-up model executions. The lack of spatial structure is partially compensated by the model parameter <strong>charge capacity</strong>, which simulates a limited space for population expansion.</li>
<li>
<strong>The environmental niche of the species follows a Gaussian distribution</strong>, characterized by a mean (niche optimum, also niche position) and a standard deviation (niche breadth or tolerance).</li>
<li>
<strong>Different drivers can have a different influence on the species dynamics</strong>, and that influence can be defined by the user by tuning the weights of each driver.</li>
<li>
<strong>Environmental suitability</strong>, expressed in the range [0, 1], is the result of an additive function of the species niches (normal function defined by the species’ mean and standard deviation for each driver), the drivers’ values, and the relative influence of each driver (<em>driver weights</em>).</li>
<li>
<strong>Pollen productivity is a function of the individual’s biomass and environmental suitability</strong>, so under a hypothetical constant individual’s biomass, its pollen production depends linearly on environmental suitability values.</li>
<li>
<strong>Effective fecundity is limited by environmental suitability</strong>. Low environmental suitability values limit recruitment, acting as an environmental filter. Therefore, even though the fecundity of the individuals is fixed by the <strong>fecundity</strong> parameter, the overall population fecundity is limited by environmental suitability.</li>
</ul>
<p>###Parameters###</p>
<p>We have designed a simple individual-based population model which input parameters are:</p>
<ul>
<li>
<strong>Drivers</strong>: Values of up to two drivers (provided as numeric vectors) for a given time span.</li>
<li>
<strong>Niche mean</strong>: The average (in drivers units) of the normal functions describing the species niche for each driver. This parameter defines the niche optimum of the species.</li>
<li>
<strong>Niche breadth</strong>: Standard deviations (in driver units) of the normal functions describing the species niche for each driver. Smaller values simulate more specialized species, while larger values simulate generalist species.</li>
<li>
<strong>Driver weight</strong>: Importance of each driver (note that in the paper we only used one driver) in defining climatic suitability for the given species. Balanced weights mean each driver is contributing equally to climatic suitability. The sum of both drivers must be 1.</li>
<li>
<strong>Maximum age</strong>: age (in years) of senescence of the individuals. Individuals die when reaching this age.</li>
<li>
<strong>Reproductive age</strong>: age (in years) at which individuals start to produce pollen and seeds.</li>
<li>
<strong>Fecundity</strong>: actually, <strong>effective fecundity</strong>, which is the maximum number of viable seeds produced by mature individuals per year under under fully suitable climatic conditions.</li>
<li>
<strong>Growth rate</strong>: amount of the maximum biomass gained per year by each individual. Used as input in the logistic equation of the growth model.</li>
<li>
<strong>Maximum biomass</strong>: maximum biomass (in relative units) individuals can reach. Used as input in the logistic equation of the growth model to set a maximum growth.</li>
<li>
<strong>Carrying capacity</strong>: maximum sum of the biomass of all individuals allowed in the model. Ideally, to keep model performance, it should be equal to <strong>maximum biomass</strong> multiplied by 100 or 1000. The model removes individuals at random when this number is reached is reached.</li>
</ul>
<p>In order to explain the model dynamics in the most simplified way, the parameters in <strong>Table 1</strong> are considered.</p>
<table class="table table">
<caption>
Parameters of a virtual species. Note that driver.B is ommited in order to simplify the explanation of the model.
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:left;">
Species 1
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
maximum.age
</td>
<td style="text-align:left;">
50
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
reproductive.age
</td>
<td style="text-align:left;">
20
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:left;">
fecundity
</td>
<td style="text-align:left;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
growth.rate
</td>
<td style="text-align:left;">
0.2
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
pollen.control
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
maximum.biomass
</td>
<td style="text-align:left;">
100
</td>
</tr>
<tr>
<td style="text-align:left;">
7
</td>
<td style="text-align:left;">
carrying.capacity
</td>
<td style="text-align:left;">
10000
</td>
</tr>
<tr>
<td style="text-align:left;">
8
</td>
<td style="text-align:left;">
driver.A.weight
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
10
</td>
<td style="text-align:left;">
niche.A.mean
</td>
<td style="text-align:left;">
50
</td>
</tr>
<tr>
<td style="text-align:left;">
11
</td>
<td style="text-align:left;">
niche.A.sd
</td>
<td style="text-align:left;">
10
</td>
</tr>
</tbody>
</table>
<p>###Ecological niche and environmental suitability###</p>
<p>The model assumes that normal distributions can be used as simple mathematical representations of ecological niches. Considering a virtual species and an environmental predictor, the abundance of the species along the range of the predictor values can be defined by a normal distribution with a mean <span class="math inline">\(μ\)</span> (niche optimum or niche position), and standard deviation <span class="math inline">\(σ\)</span> (niche breadth or tolerance).</p>
<p>The equation to compute the density of a normal distribution has the form:</p>
<p><strong>Equation 1:</strong> <span class="math display">\[f(x) = 1/(√(2 π) σ) e^{-((x - μ)^2/(2 σ^2))}\]</span> </p>
<p>Where:</p>
<ul>
<li>
<span class="math inline">\(x\)</span> is the value of the predictor.</li>
<li>
<span class="math inline">\(μ\)</span> is the mean of the normal distribution.</li>
<li>
<span class="math inline">\(σ\)</span> is the standard deviation.</li>
</ul>
<p>The following code shows a simple example on how <em>dnorm()</em> uses <strong>Equation 1</strong> to compute the density of a normal function over a data range from a mean and a standard deviation:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">niche.A &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">dnorm</a></span>(<span class="dt">x=</span><span class="dv">0</span><span class="op">:</span><span class="dv">100</span>, <span class="dt">mean=</span><span class="dv">50</span>, <span class="dt">sd=</span><span class="dv">10</span>)</a></code></pre></div>
<p>We use the code above and a computation on the density of the driver to plot the ecological niche of the virtual taxa against the availability of driver values (<strong>Figure 6</strong>).</p>
<div class="figure">
<img src="using_virtualPollen_files/figure-html/unnamed-chunk-13-1.png" alt="Ecological niche of the virtual species (blue) against the density (relative availability of values over time) of the driver (gray). Both densities have been scaled in the range [0, 1]." width="576"><p class="caption">
Ecological niche of the virtual species (blue) against the density (relative availability of values over time) of the driver (gray). Both densities have been scaled in the range [0, 1].
</p>
</div>
<p>Environmental suitability for the given species over the study period is computed as follows:</p>
<ol style="list-style-type: decimal">
<li>
<em>dnorm()</em> is computed on the mean and standard deviation defined for the species niche for a given driver.</li>
<li>The output of <em>dnorm()</em> is scaled to the range [0, 1].</li>
<li>The scaled values of the output are multiplied by the driver weights (which equals 1 if only one driver is used).</li>
<li>If there are two drivers, suitability values of each individual driver are summed together.</li>
</ol>
<p>A <strong>burn-in period</strong> with a length of ten generations of the virtual taxa is added to the environmental suitability computed from the species niche and the driver/drivers. The added segment starts at maximum environmental suitability, stays there for five generations, and decreases linearly for another five generations until meeting the first suitability value of the actual simulation time. The whole burn-in segment has a small amount of white noise added (<strong>Figure 7</strong>). The burn-in period lets the population model to warm-up and go beyond starting conditions before simulation time starts.</p>
<div class="figure">
<img src="using_virtualPollen_files/figure-html/unnamed-chunk-14-1.png" alt="Driver and environmental suitability of the virtual taxa. Burn-in period is highlighted by a gray box in the Environmental suitability panel." width="864"><p class="caption">
Driver and environmental suitability of the virtual taxa. Burn-in period is highlighted by a gray box in the Environmental suitability panel.
</p>
</div>
<p>###Biomass growth###</p>
<p>Individuals age one year on each simulation step, and their biomass at any given age is defined by the following equation of logistic growth (<strong>Equation 2</strong>). <strong>Figure 8</strong> shows different growth curves for different growth rates for a virtual taxon with a maximum age of 400 years.</p>
<p><strong>Equation 2:</strong> <span class="math display">\[f(x) = \frac{B}{1 + B} \times e^{(- \alpha \times t)}\]</span> </p>
<p>Where:</p>
<ul>
<li>
<span class="math inline">\(B\)</span> is the maximum biomass an individual can reach.</li>
<li>
<span class="math inline">\(\alpha\)</span> is the growth rate.</li>
<li>
<span class="math inline">\(t\)</span> is the age of the individual at a given time.</li>
</ul>
<div class="figure">
<img src="using_virtualPollen_files/figure-html/unnamed-chunk-15-1.png" alt="Biomass vs. age curves resulting from different growth rates for a 400 years life-span." width="576"><p class="caption">
Biomass vs. age curves resulting from different growth rates for a 400 years life-span.
</p>
</div>
<p>###Population dynamics###</p>
<p>The model starts with a population of 100 individuals with random ages, in the range [1, maximum age], taken from a uniform distribution (all ages are equiprobable). For each environmental suitability value, including the burn-in period, the model performs the following operations:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Aging:</strong> adds one year to the age of the individuals.</li>
<li>
<strong>Mortality due to senescence:</strong> individuals reaching the maximum age are removed from the simulation.
<ul>
<li>
<strong>Local extinction and immigration</strong> If the number of individuals drops to zero, the population is replaced by a “seed bank” of 100 individuals with age zero, and the simulation jumps to step <strong>7.</strong>. This is intended to simulate the arrival of seeds from nearby regions, and will only lead to population growth if environmental suitability is higher than zero.</li>
</ul>
</li>
<li>
<strong>Plant growth:</strong> Applies a plant growth equation to compute the biomass of every individual (see <strong>Figure 8</strong>).</li>
<li>
<strong>Carrying capacity:</strong> If maximum population biomass is reached, individuals are iteratively selected for removal according to a mortality risk curve computed by <strong>Equation 3</strong> (see <strong>Figure 9</strong>). This curve gives removal preference to younger individuals, matching observed patterns in natural populations.</li>
<li>
<strong>Pollen productivity:</strong> In each time step the model computes the pollen productivity (in relative values) of the population using <strong>Equation 4</strong>.</li>
<li>
<strong>Reproduction:</strong> Generates as many seeds as reproductive individuals are available multiplied by the maximum fecundity and the environmental suitability of the given time.</li>
</ol>
<p>The model returns a table with climatic suitability, pollen production, and population size (reproductive individuals only) per simulation year. <strong>Figure 10</strong> shows the results of the population model when applied to the example virtual species.</p>
<p><strong>Equation 3:</strong> <span class="math display">\[P_{m} = 1 - sqrt(a/A)\]</span> </p>
<p>Where:</p>
<ul>
<li>
<span class="math inline">\(P_{m}\)</span> is the probability of mortality.</li>
<li>
<span class="math inline">\(a\)</span> is the age of the given individual.</li>
<li>
<span class="math inline">\(A\)</span> is the maximum age reached by the virtual taxa.</li>
</ul>
<div class="figure">
<img src="using_virtualPollen_files/figure-html/unnamed-chunk-16-1.png" alt="Risk curve defining the probability of removal of a given individual as a function of its fractional age when maximum carrying capacity is reached." width="576"><p class="caption">
Risk curve defining the probability of removal of a given individual as a function of its fractional age when maximum carrying capacity is reached.
</p>
</div>
<p><strong>Equation 4:</strong> <span class="math display">\[P_{t} = \sum x_{it} \times max(S_{t}, B)\]</span> </p>
<p>Where:</p>
<ul>
<li>
<span class="math inline">\(t\)</span> is time (a given simulation time step).</li>
<li>
<span class="math inline">\(P\)</span> is the pollen productivity of the population at a given time.</li>
<li>
<span class="math inline">\(x_{i}\)</span> represents the biomass of every adult individual.</li>
<li>
<span class="math inline">\(S\)</span> is the environmental suitability at the given time.</li>
<li>
<span class="math inline">\(B\)</span> is the contribution of biomass to pollen productivity regardless of environmental suitability (<em>pollen.control</em> parameter in the simulation, 0 by default). If <span class="math inline">\(B\)</span> equals 1, <span class="math inline">\(P\)</span> is equal to the total biomass sum of the adult population, regardless of the environmental suitability. If <span class="math inline">\(B\)</span> equals 0, pollen productivity depends entirely on environmental suitability values.</li>
</ul>
<p>The code below shows the core of the <em>simulatePopulation</em> function. It is slightly simplified to improve readability, and only pollen counts are written as output. Note that age of individuals is represented as a proportion of the maximum age to facilitate operations throughout the code.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co">#parameters (1st line in dataframe "parameters")</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">maximum.age &lt;-<span class="st"> </span>parameters[<span class="dv">1</span>, <span class="st">"maximum.age"</span>]</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">reproductive.age &lt;-<span class="st"> </span>parameters[<span class="dv">1</span>, <span class="st">"reproductive.age"</span>]</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">growth.rate &lt;-<span class="st"> </span>parameters[<span class="dv">1</span>, <span class="st">"growth.rate"</span>]</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">carrying.capacity &lt;-<span class="st"> </span>parameters[<span class="dv">1</span>, <span class="st">"carrying.capacity"</span>]</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">fecundity &lt;-<span class="st"> </span>parameters[<span class="dv">1</span>, <span class="st">"fecundity"</span>]</a>
<a class="sourceLine" id="cb7-7" data-line-number="7"></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#reproductive age to proportion</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9">reproductive.age &lt;-<span class="st"> </span>reproductive.age <span class="op">/</span><span class="st"> </span>maximum.age</a>
<a class="sourceLine" id="cb7-10" data-line-number="10"></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#years scaled taking maximum.age as reference</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12">scaled.year &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span>maximum.age</a>
<a class="sourceLine" id="cb7-13" data-line-number="13"></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#vector to store pollen counts</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15">pollen.count &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">vector</a></span>()</a>
<a class="sourceLine" id="cb7-16" data-line-number="16"></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="co">#starting population</span></a>
<a class="sourceLine" id="cb7-18" data-line-number="18">population &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sample">sample</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">by=</span>scaled.year), </a>
<a class="sourceLine" id="cb7-19" data-line-number="19">                    <span class="dv">100</span>, </a>
<a class="sourceLine" id="cb7-20" data-line-number="20">                    <span class="dt">replace=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb7-21" data-line-number="21"></a>
<a class="sourceLine" id="cb7-22" data-line-number="22"><span class="co">#iterating through suitability (once per year)</span></a>
<a class="sourceLine" id="cb7-23" data-line-number="23"><span class="co">#------------------------------------</span></a>
<a class="sourceLine" id="cb7-24" data-line-number="24"><span class="cf">for</span>(suitability.i <span class="cf">in</span> suitability){</a>
<a class="sourceLine" id="cb7-25" data-line-number="25">  </a>
<a class="sourceLine" id="cb7-26" data-line-number="26">  <span class="co">#AGING -----------------------------------------------</span></a>
<a class="sourceLine" id="cb7-27" data-line-number="27">  population &lt;-<span class="st"> </span>population <span class="op">+</span><span class="st"> </span>scaled.year</a>
<a class="sourceLine" id="cb7-28" data-line-number="28">  </a>
<a class="sourceLine" id="cb7-29" data-line-number="29">  <span class="co">#SENESCENCE ------------------------------------------</span></a>
<a class="sourceLine" id="cb7-30" data-line-number="30">  <span class="co">#1 is the maximum age of ages expressed as proportions</span></a>
<a class="sourceLine" id="cb7-31" data-line-number="31">  population &lt;-<span class="st"> </span>population[population <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb7-32" data-line-number="32">  </a>
<a class="sourceLine" id="cb7-33" data-line-number="33">  <span class="co">#LOCAL EXTINCTION AND RECOLONIZATION -----------------</span></a>
<a class="sourceLine" id="cb7-34" data-line-number="34">  <span class="cf">if</span> (<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(population) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>){</a>
<a class="sourceLine" id="cb7-35" data-line-number="35">    </a>
<a class="sourceLine" id="cb7-36" data-line-number="36">    <span class="co">#local extinction, replaces population with a seedbank</span></a>
<a class="sourceLine" id="cb7-37" data-line-number="37">    population &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">0</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">floor</a></span>(<span class="dv">100</span> <span class="op">*</span><span class="st"> </span>suitability.i))</a>
<a class="sourceLine" id="cb7-38" data-line-number="38">    </a>
<a class="sourceLine" id="cb7-39" data-line-number="39">    <span class="co">#adds 0 to pollen.count</span></a>
<a class="sourceLine" id="cb7-40" data-line-number="40">    pollen.count &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(pollen.count, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb7-41" data-line-number="41">    </a>
<a class="sourceLine" id="cb7-42" data-line-number="42">    <span class="co">#jumps to next iteration</span></a>
<a class="sourceLine" id="cb7-43" data-line-number="43">    <span class="cf">next</span></a>
<a class="sourceLine" id="cb7-44" data-line-number="44">  }</a>
<a class="sourceLine" id="cb7-45" data-line-number="45">  </a>
<a class="sourceLine" id="cb7-46" data-line-number="46">  <span class="co">#PLANT GROWTH ---------------------------------------</span></a>
<a class="sourceLine" id="cb7-47" data-line-number="47">  <span class="co">#biomass of every individual</span></a>
<a class="sourceLine" id="cb7-48" data-line-number="48">  biomass &lt;-<span class="st"> </span>maximum.biomass <span class="op">/</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-49" data-line-number="49"><span class="st">    </span>(<span class="dv">1</span> <span class="op">+</span><span class="st">  </span>maximum.biomass <span class="op">*</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-50" data-line-number="50"><span class="st">       </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(<span class="op">-</span><span class="st"> </span>(growth.rate <span class="op">*</span><span class="st"> </span>suitability.i) <span class="op">*</span></a>
<a class="sourceLine" id="cb7-51" data-line-number="51"><span class="st">             </span>(population <span class="op">*</span><span class="st"> </span>maximum.age)</a>
<a class="sourceLine" id="cb7-52" data-line-number="52">           )</a>
<a class="sourceLine" id="cb7-53" data-line-number="53">     )</a>
<a class="sourceLine" id="cb7-54" data-line-number="54">  </a>
<a class="sourceLine" id="cb7-55" data-line-number="55">  <span class="co">#SELF-THINNING --------------------------------------</span></a>
<a class="sourceLine" id="cb7-56" data-line-number="56">  <span class="co">#carrying capacity reached</span></a>
<a class="sourceLine" id="cb7-57" data-line-number="57">  <span class="cf">while</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(biomass) <span class="op">&gt;</span><span class="st"> </span>carrying.capacity){</a>
<a class="sourceLine" id="cb7-58" data-line-number="58">    </a>
<a class="sourceLine" id="cb7-59" data-line-number="59">    <span class="co">#removes a random individual based on risk curve</span></a>
<a class="sourceLine" id="cb7-60" data-line-number="60">    individual.to.remove &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sample">sample</a></span>(</a>
<a class="sourceLine" id="cb7-61" data-line-number="61">      <span class="dt">x =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(population),</a>
<a class="sourceLine" id="cb7-62" data-line-number="62">      <span class="dt">size =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb7-63" data-line-number="63">      <span class="dt">replace =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb7-64" data-line-number="64">      <span class="dt">prob =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">sqrt</a></span>(population) <span class="co">#risk curve</span></a>
<a class="sourceLine" id="cb7-65" data-line-number="65">    )</a>
<a class="sourceLine" id="cb7-66" data-line-number="66">    </a>
<a class="sourceLine" id="cb7-67" data-line-number="67">    <span class="co">#removing individuals from population and biomass</span></a>
<a class="sourceLine" id="cb7-68" data-line-number="68">    population &lt;-<span class="st"> </span>population[<span class="op">-</span>individual.to.remove]</a>
<a class="sourceLine" id="cb7-69" data-line-number="69">    biomass &lt;-<span class="st"> </span>biomass[<span class="op">-</span>individual.to.remove]</a>
<a class="sourceLine" id="cb7-70" data-line-number="70">    </a>
<a class="sourceLine" id="cb7-71" data-line-number="71">  }<span class="co">#end of while</span></a>
<a class="sourceLine" id="cb7-72" data-line-number="72">  </a>
<a class="sourceLine" id="cb7-73" data-line-number="73">  <span class="co">#REPRODUCTION --------------------------------------</span></a>
<a class="sourceLine" id="cb7-74" data-line-number="74">  <span class="co">#identifyies adult individuals</span></a>
<a class="sourceLine" id="cb7-75" data-line-number="75">  adults &lt;-<span class="st"> </span>population <span class="op">&gt;</span><span class="st"> </span>reproductive.age</a>
<a class="sourceLine" id="cb7-76" data-line-number="76">  </a>
<a class="sourceLine" id="cb7-77" data-line-number="77">  <span class="co">#seeds (vector of 0s)</span></a>
<a class="sourceLine" id="cb7-78" data-line-number="78">  <span class="co">#fractional biomass of adults * fecundity * suitability</span></a>
<a class="sourceLine" id="cb7-79" data-line-number="79">  seeds &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">0</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">floor</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>((biomass[adults]<span class="op">/</span>maximum.biomass) <span class="op">*</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-80" data-line-number="80"><span class="st">                              </span>fecundity) <span class="op">*</span><span class="st"> </span>suitability.i))</a>
<a class="sourceLine" id="cb7-81" data-line-number="81">  </a>
<a class="sourceLine" id="cb7-82" data-line-number="82">  <span class="co">#adding seeds to the population</span></a>
<a class="sourceLine" id="cb7-83" data-line-number="83">  population &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(population, seeds)</a>
<a class="sourceLine" id="cb7-84" data-line-number="84">  </a>
<a class="sourceLine" id="cb7-85" data-line-number="85">  <span class="co">#POLLEN OUTPUT -------------------------------------</span></a>
<a class="sourceLine" id="cb7-86" data-line-number="86">  <span class="co">#biomass of adults multiplied by suitability</span></a>
<a class="sourceLine" id="cb7-87" data-line-number="87">  pollen.count &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(pollen.count, </a>
<a class="sourceLine" id="cb7-88" data-line-number="88">                    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(biomass[adults]) <span class="op">*</span><span class="st"> </span>suitability.i)</a>
<a class="sourceLine" id="cb7-89" data-line-number="89">  </a>
<a class="sourceLine" id="cb7-90" data-line-number="90">} <span class="co">#end of loop through suitability values</span></a></code></pre></div>
<p>The code below executes the simulation, and plots the outcome using the function <em>plotSimulation</em>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co">#simulate population based on parameters</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">simulation &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simulatePopulation.html">simulatePopulation</a></span>(<span class="dt">parameters=</span>parameters[<span class="dv">1</span>, ], </a>
<a class="sourceLine" id="cb8-3" data-line-number="3">                                 <span class="dt">drivers=</span>driver)</a>
<a class="sourceLine" id="cb8-4" data-line-number="4"></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#plotting simulation output</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="kw"><a href="../reference/plotSimulation.html">plotSimulation</a></span>(<span class="dt">simulation.output=</span>simulation, </a>
<a class="sourceLine" id="cb8-7" data-line-number="7">               <span class="dt">burnin=</span><span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb8-8" data-line-number="8">               <span class="dt">panels=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Driver A"</span>, </a>
<a class="sourceLine" id="cb8-9" data-line-number="9">                        <span class="st">"Suitability"</span>, </a>
<a class="sourceLine" id="cb8-10" data-line-number="10">                        <span class="st">"Population"</span>, </a>
<a class="sourceLine" id="cb8-11" data-line-number="11">                        <span class="st">"Pollen"</span>), </a>
<a class="sourceLine" id="cb8-12" data-line-number="12">               <span class="dt">plot.title=</span><span class="st">""</span>,</a>
<a class="sourceLine" id="cb8-13" data-line-number="13">               <span class="dt">text.size=</span><span class="dv">12</span>,</a>
<a class="sourceLine" id="cb8-14" data-line-number="14">               <span class="dt">line.size=</span><span class="fl">0.4</span>)</a></code></pre></div>
<div class="figure">
<img src="using_virtualPollen_files/figure-html/unnamed-chunk-18-1.png" alt="Simulation outcome. Green shades represent different age groups (seedlings, saplings, and adults)." width="864"><p class="caption">
Simulation outcome. Green shades represent different age groups (seedlings, saplings, and adults).
</p>
</div>
<p>The simulation outcomes can vary with the traits of the virtual species. <strong>Table 2</strong> shows the parameters of two new taxa named <strong>Species 2</strong> and <strong>Species 3</strong>. These species have a higher niche breadth than <strong>Species 1</strong>, and <strong>Species 3</strong> has a pollen productivity depending more on biomass than suitability (parameter <em>pollen.control</em> higher than zero). The comparison of both simulations (<strong>Figure 11</strong>) along with <strong>Species 1</strong> shows that different traits generate different pollen curves in our simulation.</p>
<table class="table table">
<caption>
Parameters of the three virtual species.
</caption>
<thead><tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:left;">
Species 1
</th>
<th style="text-align:left;">
Species 2
</th>
<th style="text-align:left;">
Species 3
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
maximum.age
</td>
<td style="text-align:left;">
50
</td>
<td style="text-align:left;">
50
</td>
<td style="text-align:left;">
50
</td>
</tr>
<tr>
<td style="text-align:left;">
reproductive.age
</td>
<td style="text-align:left;">
20
</td>
<td style="text-align:left;">
20
</td>
<td style="text-align:left;">
20
</td>
</tr>
<tr>
<td style="text-align:left;">
fecundity
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
growth.rate
</td>
<td style="text-align:left;">
0.2
</td>
<td style="text-align:left;">
0.3
</td>
<td style="text-align:left;">
0.4
</td>
</tr>
<tr>
<td style="text-align:left;">
pollen.control
</td>
<td style="text-align:left;">
0.0
</td>
<td style="text-align:left;">
0.0
</td>
<td style="text-align:left;">
0.5
</td>
</tr>
<tr>
<td style="text-align:left;">
maximum.biomass
</td>
<td style="text-align:left;">
100
</td>
<td style="text-align:left;">
100
</td>
<td style="text-align:left;">
100
</td>
</tr>
<tr>
<td style="text-align:left;">
carrying.capacity
</td>
<td style="text-align:left;">
10000
</td>
<td style="text-align:left;">
10000
</td>
<td style="text-align:left;">
10000
</td>
</tr>
<tr>
<td style="text-align:left;">
driver.A.weight
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
niche.A.mean
</td>
<td style="text-align:left;">
50
</td>
<td style="text-align:left;">
50
</td>
<td style="text-align:left;">
50
</td>
</tr>
<tr>
<td style="text-align:left;">
niche.A.sd
</td>
<td style="text-align:left;">
10
</td>
<td style="text-align:left;">
15
</td>
<td style="text-align:left;">
20
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co">#simulating species 2 and 3 of the dataframe parameters</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">simulation<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simulatePopulation.html">simulatePopulation</a></span>(<span class="dt">parameters=</span>parameters, </a>
<a class="sourceLine" id="cb9-3" data-line-number="3">                                   <span class="dt">species=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span>,<span class="dv">3</span>), </a>
<a class="sourceLine" id="cb9-4" data-line-number="4">                                   <span class="dt">drivers=</span>driver)</a>
<a class="sourceLine" id="cb9-5" data-line-number="5"></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">#adding the results to the previous simulation</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">simulation &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(simulation, simulation<span class="fl">.2</span>)</a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(simulation<span class="fl">.2</span>)</a>
<a class="sourceLine" id="cb9-9" data-line-number="9"></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="co">#plotting the comparison for the time interval between 4000 and 5000.-</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="kw"><a href="../reference/compareSimulations.html">compareSimulations</a></span>(<span class="dt">simulation.output=</span>simulation, </a>
<a class="sourceLine" id="cb9-12" data-line-number="12">                   <span class="dt">species =</span> <span class="st">"all"</span>,</a>
<a class="sourceLine" id="cb9-13" data-line-number="13">                   <span class="dt">columns =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Suitability"</span>, <span class="st">"Pollen"</span>), </a>
<a class="sourceLine" id="cb9-14" data-line-number="14">                   <span class="dt">time.zoom =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5600</span>, <span class="dv">6400</span>))</a></code></pre></div>
<div class="figure">
<img src="using_virtualPollen_files/figure-html/unnamed-chunk-20-1.png" alt="Comparison of the pollen abundance and environmental suitability (same in all cases) for the three virtual species shown in Table 2 within the period 5600-6400. Species 2 has a higher fecundity than Species 1 (1 vs 10)" width="864"><p class="caption">
Comparison of the pollen abundance and environmental suitability (same in all cases) for the three virtual species shown in Table 2 within the period 5600-6400. Species 2 has a higher fecundity than Species 1 (1 vs 10)
</p>
</div>
<p>###Testing the model limits###</p>
<p>We searched for the minimum values of the parameters required to keep a simulated population viable under fully suitable conditions. The taxa <em>Test 1</em> and <em>Test 2</em> shown below</p>
<table class="table">
<caption>
Parameters of virtual taxa used to test model limits.
</caption>
<thead><tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:left;">
Test 1
</th>
<th style="text-align:left;">
Test 2
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
maximum.age
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
reproductive.age
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
fecundity
</td>
<td style="text-align:left;">
0.55
</td>
<td style="text-align:left;">
0.50
</td>
</tr>
<tr>
<td style="text-align:left;">
growth.rate
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
pollen.control
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
maximum.biomass
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
carrying.capacity
</td>
<td style="text-align:left;">
30
</td>
<td style="text-align:left;">
30
</td>
</tr>
<tr>
<td style="text-align:left;">
driver.A.weight
</td>
<td style="text-align:left;">
0.5
</td>
<td style="text-align:left;">
0.5
</td>
</tr>
<tr>
<td style="text-align:left;">
driver.B.weight
</td>
<td style="text-align:left;">
0.5
</td>
<td style="text-align:left;">
0.5
</td>
</tr>
<tr>
<td style="text-align:left;">
niche.A.mean
</td>
<td style="text-align:left;">
50
</td>
<td style="text-align:left;">
50
</td>
</tr>
<tr>
<td style="text-align:left;">
niche.A.sd
</td>
<td style="text-align:left;">
10
</td>
<td style="text-align:left;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
niche.B.mean
</td>
<td style="text-align:left;">
50
</td>
<td style="text-align:left;">
50
</td>
</tr>
<tr>
<td style="text-align:left;">
niche.B.sd
</td>
<td style="text-align:left;">
10
</td>
<td style="text-align:left;">
10
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">simulation.test<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simulatePopulation.html">simulatePopulation</a></span>(</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">  <span class="dt">parameters=</span>parameters.test,</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">  <span class="dt">driver.A=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/jitter">jitter</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">50</span>, <span class="dv">500</span>), <span class="dt">amount=</span><span class="dv">4</span>)</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">  )</a></code></pre></div>
<p>The test driver used had an average of 50 (optimum values according the environmental niche of both species) for 500 years, with random noise added through the <em>jitter</em> function. The model results (column <em>Pollen</em> only) for both virtual taxa are shown below.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="../reference/compareSimulations.html">compareSimulations</a></span>(<span class="dt">simulation.output=</span>simulation.test<span class="fl">.1</span>, </a>
<a class="sourceLine" id="cb11-2" data-line-number="2">                   <span class="dt">columns=</span><span class="st">"Pollen"</span>, </a>
<a class="sourceLine" id="cb11-3" data-line-number="3">                   <span class="dt">time.zoom =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">200</span>))</a></code></pre></div>
<div class="figure">
<img src="using_virtualPollen_files/figure-html/unnamed-chunk-23-1.png" alt="Pollen output of virtual taxa Test 1 and Test 2 for a 200 years time-window." width="864"><p class="caption">
Pollen output of virtual taxa Test 1 and Test 2 for a 200 years time-window.
</p>
</div>
<p>The outputs of the test taxa show how a minimal change in the parameters can lead to fully unstable results when the considered taxa are short lived. Considering such a result, values for life-traits (<em>maximum.age</em>, <em>reproductive.age</em>, <em>fecundity</em>, <em>growth.rate</em>, and <em>maximum.biomass</em>) of taxon <em>Test 1</em> should be taken as safe lower limits for these traits.</p>
<p>A similar situation can happen with long lived species when the age of sexual maturity is close to the maximum age. The table below shows three new test species with long life-spans and increasing maturity ages. The driver is again centered in 50, with added white noise, and 2000 years length.</p>
<table class="table">
<caption>
Parameters of virtual taxa used to test model limits.
</caption>
<thead><tr>
<th style="text-align:left;">
Parameter
</th>
<th style="text-align:left;">
Test 3
</th>
<th style="text-align:left;">
Test 4
</th>
<th style="text-align:left;">
Test 5
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
maximum.age
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
1000
</td>
<td style="text-align:left;">
1000
</td>
</tr>
<tr>
<td style="text-align:left;">
reproductive.age
</td>
<td style="text-align:left;">
100
</td>
<td style="text-align:left;">
500
</td>
<td style="text-align:left;">
900
</td>
</tr>
<tr>
<td style="text-align:left;">
fecundity
</td>
<td style="text-align:left;">
0.5
</td>
<td style="text-align:left;">
0.5
</td>
<td style="text-align:left;">
0.5
</td>
</tr>
<tr>
<td style="text-align:left;">
growth.rate
</td>
<td style="text-align:left;">
0.05
</td>
<td style="text-align:left;">
0.05
</td>
<td style="text-align:left;">
0.05
</td>
</tr>
<tr>
<td style="text-align:left;">
pollen.control
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
maximum.biomass
</td>
<td style="text-align:left;">
100
</td>
<td style="text-align:left;">
100
</td>
<td style="text-align:left;">
100
</td>
</tr>
<tr>
<td style="text-align:left;">
carrying.capacity
</td>
<td style="text-align:left;">
10000
</td>
<td style="text-align:left;">
10000
</td>
<td style="text-align:left;">
10000
</td>
</tr>
<tr>
<td style="text-align:left;">
driver.A.weight
</td>
<td style="text-align:left;">
0.5
</td>
<td style="text-align:left;">
0.5
</td>
<td style="text-align:left;">
0.5
</td>
</tr>
<tr>
<td style="text-align:left;">
driver.B.weight
</td>
<td style="text-align:left;">
0.5
</td>
<td style="text-align:left;">
0.5
</td>
<td style="text-align:left;">
0.5
</td>
</tr>
<tr>
<td style="text-align:left;">
niche.A.mean
</td>
<td style="text-align:left;">
50
</td>
<td style="text-align:left;">
50
</td>
<td style="text-align:left;">
50
</td>
</tr>
<tr>
<td style="text-align:left;">
niche.A.sd
</td>
<td style="text-align:left;">
10
</td>
<td style="text-align:left;">
10
</td>
<td style="text-align:left;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
niche.B.mean
</td>
<td style="text-align:left;">
50
</td>
<td style="text-align:left;">
50
</td>
<td style="text-align:left;">
50
</td>
</tr>
<tr>
<td style="text-align:left;">
niche.B.sd
</td>
<td style="text-align:left;">
10
</td>
<td style="text-align:left;">
10
</td>
<td style="text-align:left;">
10
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">simulation.test<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simulatePopulation.html">simulatePopulation</a></span>(</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">  <span class="dt">parameters=</span>parameters.test,</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">  <span class="dt">species=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">3</span><span class="op">:</span><span class="dv">5</span>),</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">  <span class="dt">driver.A=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/jitter">jitter</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">50</span>, <span class="dv">2000</span>), <span class="dt">amount=</span><span class="dv">4</span>)</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">  )</a></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw"><a href="../reference/compareSimulations.html">compareSimulations</a></span>(<span class="dt">simulation.output=</span>simulation.test<span class="fl">.2</span>, </a>
<a class="sourceLine" id="cb13-2" data-line-number="2">                   <span class="dt">columns=</span><span class="st">"Pollen"</span>, </a>
<a class="sourceLine" id="cb13-3" data-line-number="3">                   <span class="dt">time.zoom =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">800</span>))</a></code></pre></div>
<div class="figure">
<img src="using_virtualPollen_files/figure-html/unnamed-chunk-26-1.png" alt="Pollen output of virtual taxa Test 1 and Test 2 for a 200 years time-window." width="864"><p class="caption">
Pollen output of virtual taxa Test 1 and Test 2 for a 200 years time-window.
</p>
</div>
<p>The figure shows how <em>Test 3</em> yields a stable pollen productivity across time, while <em>Test 4</em> and <em>Test 5</em> show, respectively, a very low productivity due to scarcity of adults, a total inability to sustain stable populations. Considering these results, it is important to keep a careful balance between the parameters <em>maximum.age</em> and <em>reproductive.age</em> to obtain viable virtual populations.</p>
<p>#Simulating a virtual accumulation rate#</p>
<p>Sediments containing pollen grains accumulate at varying rates, generally measured in <em>years per centimeter</em> (y/cm). Accumulation rates found in real datasets are broadly between 10 and 70 y/cm, with a paulatine increase towards the present time. To simulate such an effect and aggregate the annual data produced by the simulation in a realistic manner we have written a function named <em>simulateAccumulationRate</em> that takes a random seed, a time-span, and a range of possible accumulation rate values, and generates a virtual accumulation rate curve. It does so by generating a random walk first, smoothing it through the application of a GAM model, and scaling it between given minimum and maximum accumulation rates (see <strong>Figure 12</strong>).</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">accumulation.rate &lt;-<span class="st"> </span><span class="kw"><a href="../reference/simulateAccumulationRate.html">simulateAccumulationRate</a></span>(<span class="dt">seed=</span><span class="dv">140</span>, </a>
<a class="sourceLine" id="cb14-2" data-line-number="2">                                              <span class="dt">time=</span><span class="dv">1</span><span class="op">:</span><span class="dv">10000</span>, </a>
<a class="sourceLine" id="cb14-3" data-line-number="3">                                              <span class="dt">output.min=</span><span class="dv">1</span>, </a>
<a class="sourceLine" id="cb14-4" data-line-number="4">                                              <span class="dt">output.max=</span><span class="dv">50</span>)</a></code></pre></div>
<div class="figure">
<img src="using_virtualPollen_files/figure-html/unnamed-chunk-27-1.png" alt="Virtual sediment accumulation rate." width="864"><p class="caption">
Virtual sediment accumulation rate.
</p>
</div>
<p>The output is a dataframe with three columns: <em>time</em>, <em>accumulation.rate</em>, and <em>grouping</em> (see <strong>Table 4</strong>).</p>
<table class="table table">
<caption>
Dataframe resulting from the function to generate virtual accumulation rates. Each group in the grouping column has as many elements as accumulation.rate the given group has.
</caption>
<thead><tr>
<th style="text-align:right;">
time
</th>
<th style="text-align:right;">
accumulation.rate
</th>
<th style="text-align:right;">
grouping
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>Cases of the simulation data belonging to the same group according to the <em>grouping</em> column are aggregated together to simulate a <em>centimeter</em> of sedimented data. The data are aggregated by the function <em>aggregateSimulation</em>, that can additionally sample the resulting data at given depth intervals expressed in centimeters between consecutive samples (2, 6, and 10 cm in the code below).</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">simulation.aggregated &lt;-<span class="st"> </span><span class="kw"><a href="../reference/aggregateSimulation.html">aggregateSimulation</a></span>(</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">  <span class="dt">simulation.output=</span>simulation, </a>
<a class="sourceLine" id="cb15-3" data-line-number="3">  <span class="dt">accumulation.rate=</span>accumulation.rate, </a>
<a class="sourceLine" id="cb15-4" data-line-number="4">  <span class="dt">sampling.intervals=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">  )</a></code></pre></div>
<p>The function returns a matrix-like list with as many rows as simulations are available in <em>simulation.output</em>, a column containing the data of the original simulations, a column with the data aggregated every centimeter, and the sampling intervals requested by the user. The data are accessed individually by list subsetting, as shown below (see <strong>Figure 13</strong>), to allow easy analysis and visualization.</p>
<div class="figure">
<img src="using_virtualPollen_files/figure-html/unnamed-chunk-30-1.png" alt="Effect of applying accumulation rate and different sampling depth intervals to a section of the the annual data produced by the simulation (represented in the Legend by the label Annual). Note that the 10 cm resampling completely misses the whole high-suitability event in the Pollen panel, and barely registers it in the Suitability panel. Inter-decadal variability shown by the Annual data is completely lost even at 1 cm, the higher sampling resolution." width="864"><p class="caption">
Effect of applying accumulation rate and different sampling depth intervals to a section of the the annual data produced by the simulation (represented in the Legend by the label Annual). Note that the 10 cm resampling completely misses the whole high-suitability event in the Pollen panel, and barely registers it in the Suitability panel. Inter-decadal variability shown by the Annual data is completely lost even at 1 cm, the higher sampling resolution.
</p>
</div>
<p>#Sampling virtual pollen curves at different depth intervals#</p>
<p>Applying a virtual accumulation rate to the data generated by the population model at given depth intervals simulates to a certain extent how pollen deposition and sampling work in reality, and the outcome of that is data-points separated by regular depth intervals, but not regular time intervals. <strong>Figure 14</strong> shows that time intervals between consecutive samples produced by <em>aggregateSimulation</em> are not regular. However, analyzing ecological memory requires to organize the input data in regular time lags, and to do that the data need to have regular time intervals between consecutive cases.</p>
<div class="figure">
<img src="using_virtualPollen_files/figure-html/unnamed-chunk-31-1.png" alt="Histogram of the time differences (in years) between consecutive samples for the outcome of aggregateSimulation when resampled at intervals of 6 centimeters on Species 1. It clearly shows how the data are not organized in regular time intervals, and therefore are unsuitable for analyses requiring regular time lags." width="576"><p class="caption">
Histogram of the time differences (in years) between consecutive samples for the outcome of aggregateSimulation when resampled at intervals of 6 centimeters on Species 1. It clearly shows how the data are not organized in regular time intervals, and therefore are unsuitable for analyses requiring regular time lags.
</p>
</div>
<p>Irregular time series can be interpolated into regular time series by using the <em>loess</em> function. This function fits a polynomial surface representing the relationship between two (or more) variables. The smoothness of this polynomial surface is modulated by the <em>span</em> parameter, and finding the right value for this parameter is critical to obtain an interpolation result as close as possible to the real data. The following code is able to find the value of <em>span</em> that maximizes the correlation between input and interpolated data for any given time series.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co">#getting example data sampled at 2cm intervals</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2">simulated.data =<span class="st"> </span>simulation.aggregated[[<span class="dv">1</span>, <span class="dv">3</span>]]</a>
<a class="sourceLine" id="cb16-3" data-line-number="3"></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="co">#span values to be explored</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6">span.values=<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">20</span><span class="op">/</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(simulated.data), </a>
<a class="sourceLine" id="cb16-7" data-line-number="7">                <span class="dv">5</span><span class="op">/</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(simulated.data), </a>
<a class="sourceLine" id="cb16-8" data-line-number="8">                <span class="dt">by=</span><span class="op">-</span><span class="fl">0.0005</span>)</a>
<a class="sourceLine" id="cb16-9" data-line-number="9"></a>
<a class="sourceLine" id="cb16-10" data-line-number="10"></a>
<a class="sourceLine" id="cb16-11" data-line-number="11"><span class="co">#plotting the optimization process in real time</span></a>
<a class="sourceLine" id="cb16-12" data-line-number="12"><span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/x11">x11</a></span>(<span class="dt">height=</span><span class="dv">12</span>, <span class="dt">width=</span><span class="dv">24</span>)</a>
<a class="sourceLine" id="cb16-13" data-line-number="13">   </a>
<a class="sourceLine" id="cb16-14" data-line-number="14"><span class="co">#iteration through candidate span values</span></a>
<a class="sourceLine" id="cb16-15" data-line-number="15"><span class="cf">for</span>(span <span class="cf">in</span> span.values){</a>
<a class="sourceLine" id="cb16-16" data-line-number="16">          </a>
<a class="sourceLine" id="cb16-17" data-line-number="17">  <span class="co">#function to interpolate the data</span></a>
<a class="sourceLine" id="cb16-18" data-line-number="18">  interpolation.function =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/loess">loess</a></span>(</a>
<a class="sourceLine" id="cb16-19" data-line-number="19">    Pollen <span class="op">~</span><span class="st"> </span>Time,</a>
<a class="sourceLine" id="cb16-20" data-line-number="20">    <span class="dt">data=</span>simulated.data,</a>
<a class="sourceLine" id="cb16-21" data-line-number="21">    <span class="dt">span=</span>span,</a>
<a class="sourceLine" id="cb16-22" data-line-number="22">    <span class="dt">control=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/loess.control">loess.control</a></span>(<span class="dt">surface=</span><span class="st">"direct"</span>))</a>
<a class="sourceLine" id="cb16-23" data-line-number="23">  </a>
<a class="sourceLine" id="cb16-24" data-line-number="24">  <span class="co">#plot model fit</span></a>
<a class="sourceLine" id="cb16-25" data-line-number="25">  <span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(simulated.data<span class="op">$</span>Pollen, <span class="dt">type=</span><span class="st">"l"</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb16-26" data-line-number="26">  <span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/lines">lines</a></span>(interpolation.function<span class="op">$</span>fitted, <span class="dt">col=</span><span class="st">"red"</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb16-27" data-line-number="27">          </a>
<a class="sourceLine" id="cb16-28" data-line-number="28">  <span class="co">#if correlation equals 0.9985 loop stops</span></a>
<a class="sourceLine" id="cb16-29" data-line-number="29">  <span class="cf">if</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/cor">cor</a></span>(interpolation.function<span class="op">$</span>fitted, </a>
<a class="sourceLine" id="cb16-30" data-line-number="30">    simulated.data<span class="op">$</span>Pollen) <span class="op">&gt;=</span><span class="st">  </span><span class="fl">0.9985</span>){<span class="cf">break</span>}</a>
<a class="sourceLine" id="cb16-31" data-line-number="31">          </a>
<a class="sourceLine" id="cb16-32" data-line-number="32">}</a>
<a class="sourceLine" id="cb16-33" data-line-number="33"></a>
<a class="sourceLine" id="cb16-34" data-line-number="34"><span class="co">#gives time to look at result before closing the plot window</span></a>
<a class="sourceLine" id="cb16-35" data-line-number="35"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.sleep">Sys.sleep</a></span>(<span class="dv">5</span>)</a></code></pre></div>
<p>The function <em>toRegularTime</em> (usage shown below), uses the code above to interpolate the data produced by <em>aggregateSimulation</em> into a given time interval, expressed in years, returning a list of the same dimensions of the input list.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">simulation.interpolated &lt;-<span class="st"> </span><span class="kw"><a href="../reference/toRegularTime.html">toRegularTime</a></span>(</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">  <span class="dt">x=</span>simulation.aggregated,</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">  <span class="dt">time.column=</span><span class="st">"Time"</span>,</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">  <span class="dt">interpolation.interval=</span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb17-5" data-line-number="5">  <span class="dt">columns.to.interpolate=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Pollen"</span>,</a>
<a class="sourceLine" id="cb17-6" data-line-number="6">                           <span class="st">"Suitability"</span>,</a>
<a class="sourceLine" id="cb17-7" data-line-number="7">                           <span class="st">"Driver.A"</span>)</a>
<a class="sourceLine" id="cb17-8" data-line-number="8">  )</a></code></pre></div>
<p><strong>Figure 15</strong> shows the same data segment shown in <strong>Figure 13</strong>, but with samples re-interpolated into a regular time grid at 10 years intervals.</p>
<div class="figure">
<img src="using_virtualPollen_files/figure-html/unnamed-chunk-34-1.png" alt="Data aggregated using virtual accumulation rate and reinterpolated into a regular time grid of 10 years resolution." width="864"><p class="caption">
Data aggregated using virtual accumulation rate and reinterpolated into a regular time grid of 10 years resolution.
</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Blas M. Benito.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
